**화면**
![](./images/2025-03-01-17-33-48.png)

![](./images/2025-03-01-17-34-28.png)


**유스케이스 시나리오**

|UC ID|관련액터|UC명|목표|
| :-- | :-- | :-- | :-- |
|UC-AA-001|사용자, 관리자, 시스템|로그인|사용자가 아이디와 비밀번호를 입력하여 시스템에 인증되고 메인 화면으로 이동한다.|

**1. 목적**
- 사용자가 아이디와 비밀번호를 입력하여 시스템에 인증되고 메인 화면으로 이동한다.

**2. 사전조건 (Preconditions)**
- BE : 사용자가 로그인 화면에 접근할 수 있어야 한다 (URL 접속 가능).
- BE : 관리자로부터 아이디와 비밀번호를 제공받은 사용자만 로그인을 시도할 수 있다.
- BE : 시스템이 정상적으로 작동 중이어야 한다.
- FE : 기본값이 테마는 "light", 언어는 "kr" 로 설정되어 있어야 한다.

**3. 기본 시나리오 (Basic Flow)**
- FE : 사용자가 로그인 화면에 접속한다.
- FE : 사용자가 아이디와 비밀번호를 입력한다.
- FE : 사용자가 "로그인" 버튼을 클릭한다.
- BE/FE : 입력된 아이디와 비밀번호를 검증한다.
- 인증 성공시:
  * FE: 로그인 성공 후 메인 화면으로 이동한다.

**4. 대안 시나리오 (Alternative Flow)**
_4.1 아이디/비밀번호 대안_
- 아이디/비밀번호 미입력
  * FE : 아이디가 입력되지 않은 경우: "사용자 아이디는 필수 입력 항목입니다!" 메시지를 아이디 입력 박스 하단에 표시한다.
  * FE : 비밀번호가 입력되지 않은 경우: "비밀번호는 6-30자이고 영문자와 숫자를 포함해야 합니다!" 메시지를 비밀번호 입력 박스 하단에 표시한다.
- 아이디/비밀번호 검증 실패
  * BE/FE : 잘못된 아이디 또는 비밀번호가 입력된 경우: "등록되지 않은 사용자입니다. 관리자에게 문의하세요!" alert 메시지를 시한다.
  * BE/FE: 아이디가 잠겼을 경우: "아이디가 잠겼습니다. 관리자에게 문의 하세요." alert 메시지를 표시한다.
- 비밀번호 입력 오류 초과
  * FE: "아이디가 잠겼습니다. 관리자에게 문의하세요!" alert 메시지를 표시한다.
- 아이피 차단
  * BE: 잠긴 아이디로 같은 아이피에서 로그인 시도시, 10회 초과면 해당 IP를 차단한다.
  * FE : IP 차단 페이지로 이동한다.
- 멀티 로그인 방지
  * 이미 동일한 아이디로 다른 곳에서 로그인한 경우:
    * FE: "다른 곳에서 현 아이디로 로그인했습니다. 자동 로그아웃 됩니다." 모달 박스로 표시한다.
    * FE: "확인" 버튼을 클릭하면 로그인 페이지로 이동한다.

_4.2 테마 변경_
- FE: 사용자가 테마 버튼을 클릭하여 테마를 변경할 수 있다:
- FE: Dark 또는 Light 모드로 변경된다.

_4.3 언어 변경_
- FE: 사용자가 언어 선택 버튼을 클릭하여 언어를 변경할 수 있다:
      지원되는 언어는 kr(한국어), en(영어), zh(중국어)이다.
      선택한 언어로 화면이 갱신된다.

**5. 사후조건 (Postconditions)**
- 성공 시:
  * FE : 사용자는 인증에 성공하고 메인 화면으로 이동할 수 있다.
  * BE : Access, Refresh Token을 발급하여 클라이언트로 전송한다.
- 실패 시:
  * FE : 사용자는 로그인 화면에 머물며, 적절한 오류 메시지가 표시된다(예: "등록되지 않은 사용자입니다").
  * BE : 계정 잠금 또는 IP 차단과 같은 보안 조치가 적용될 수 있다.

**6. 예외 (Exceptions)**
_6.1 클라이언트 측 예외_
- 아이디 또는 비밀번호가 공백일 경우:
  * FE : 해당 필드 하단에 오류 메시지를 표시한다.
- 입력값의 길이가 초과된 경우:
  * FE : 아이디와 비밀번호는 각각 최대 30자로 제한되며, 초과된 값은 서버로 전송되지 않는다.

_6.2 서버 측 예외_
- 잘못된 아이디 또는 비밀번호:
  * FE : 서버에서 검증 실패 시 "등록되지 않은 사용자입니다. 관리자에게 문의 하세요" 메시지를 반환하고 클라이언트에서 alert 메시지를 표시한다.
- 계정 잠금:
  * BE : 비밀번호를 5회 초과 잘못 입력하면 계정이 잠기며, 클라이언트에 관련 메시지를 반환한다.
- IP 차단:
  * BE : 계정 잠금 상태에서 10회 초과 추가로 로그인을 시도하면 해당 IP가 차단된다.
  * FE : IP 차단 페이지로 이동한다.
- 토큰 유효성 문제:
  * FE : Access token 만료시 refresh token을 이용해서 access token을 재요청 한다.
    - 성공시 :
      * FE : 새로운 access token을 사용한다.
      * FE : 새로운 access token을 session storage에 저장한다.
    - 실패시 :
      * FE : 유효하지 않은 refresh token 이거나, 만료가 되었다면 로그인 페이지로 이동한다.
  * BE : 서버는 요청된 refesh token의 유효성을 확인한다.
    - 성공시:
      * BE : 새로운 access token을 발급한다.
    - 실패시:
      * BE : 유효하지 안거나, 만료가 되었다는 내용을 전송한다.
- 멀티 로그인 감지:
  * FE : WebSocket을 통해 동일한 아이디로 다른 곳에서 로그인이 감지되면 자동 로그아웃 처리가 된다.

**7. 기술적 세부사항(Technical Details)**
_7.1 기본설정_
- FE : env 파일에서 읽어 테마는 기본값이 "light", 언어는 "kr"로 설정되어 있어야 한다.

_7.2 로그인 요청 처리_
- 클라이언트는 다음 로직을 수행:
  * FE: 로그인 성공시
  * FE: Access token과 refresh token을 session storage에 저장한다.

- 서버는 다음 로직을 수행:
  * BE: 데이터베이스에서 사용자 아이디와 비밀번호를 검증
  * BE: 로그인 성공시
     * 비밀번호 입력 오류 회수 및 로그인 시도 횟수를 초기화한다.
     * access token, refresh token DB에 저장한다.
     * Websocket 연결한다.
     * 멀티 로그인 체크를 위해서 아이디 Redis에 저장한다.
     * Redis에서는 로그인 아이디가 Unique 해야 한다.
     * Access Token과 Refresh Token 및 사용자 기본 정보를 전송한다(아이디, 이름, 사용자 일련번호).
  * BE: 로그인 실패시
     * 비밀번호 오류횟수 + 1을 하여 저장
     * 비밀번호 오류횟수가 5를 초과하면 계정 상태를 잠금으로 변경
     * 계정 잠금 상태에서 로그인 시도 횟수 + 1, IP저장
     *  같은 IP가 로그인 시도횟수가 10을 초과하면 아이피 Black list에 저장.

