**화면**
![](./images/2025-03-01-17-33-48.png)

![](./images/2025-03-01-17-34-28.png)


**로그인 구현 가이드**

**1. 목적**
- 사용자가 아이디와 비밀번호를 입력하여 시스템에 인증되고 메인 화면으로 이동한다.

**2. 사전조건 (Preconditions)**
- BE: 시스템이 정상적으로 작동 중이어야 한다.
- BE: 사용자가 로그인 화면에 접근할 수 있어야 한다 (URL 접속 가능).
- BE: 관리자로부터 아이디와 비밀번호를 제공받은 사용자만 로그인을 시도할 수 있다.
- FE: 브라우저 session storage에 값이 없다면, 기본값은 테마 "light", 언어 "kr" 로 설정된다.
- BE: 서버 기동시 IP Black List가 캐시에 로드되어 있어야 한다.

**3. 기본 시나리오 (Basic Flow)**
- 로그인 정보 입력
  - FE: 사용자가 아이디 inputbox에 입력한다.
  - FE: 사용자가 비밀번호 inputbox에 입력한다.
    - FE: 비밀번호 입력시 기본은 마스킹 처리가 되고, 눈동자 아이콘을 클릭하면 비밀번호를 표시한다.
- 유효성 체크
  - 아이디 미입력:
    - FE: "사용자 아이디는 필수 입력 항목입니다!" 메시지를 아이디 inputbox 하단에 표시한다.
  - 비밀번호 미입력:
    - FE: "비밀번호는 필수 입력 항목입니다!" 메시지를 비밀번호 inputbox 하단에 표시한다.
  - 아이디/비밀번호 검증 실패
    - BE: "유효하지 않은 아이디 또는 비밀번호 입니다!" 라는 메시지 Client에 전송한다.
      - FE: 시스템에서 전송된 메시지를 alert notification으로 표시한다.
  - 입력형식이 맞지 않는 경우
    - BE/FE: "입력형식이 맞지 않습니다." 라는 메시지를 inputbox 하단에 표시한다.
    - 정책
      - BE/FE: 아이디 정책 : 영문소문자 + 숫자로 구성된 3-20자리 이내
      - BE/FE: 비밀번호 정책 : 영문자 + 숫자 + 특수문자로 구성된 6-30자리 이내
- 로그인 버튼 클릭
  - BE : 전송된 아이디와 비밀번호를 검증한다.
  - 로그인 인증 성공:
    - BE: 비밀번호 입력 오류 회수 및 아이피 로그인 시도 횟수를 초기화한다.
    - BE: Refresh token을 Db에 저장한다.
    - BE: access, refresh token을 발급하여 client로 전송한다.
      - 정책:
        - access token 만료 : 15분
        - refresh token 만료 : 48시간
      - FE: access, refresh token을 브라우저 session storage에 저장한다.
    - BE: 로그인 아이디, 로그인 일시 를 캐시에 담아둔다.
      - BE: 멀티로그인 방지를 위해 로그인시 캐시에 존재하는지 체크한다.
      - BE: WebSocket으로 메시지를 보내기 위해서도 캐시를 사용한다.
    - BE/FE: Websocket을 연결한다.
    - 멀티로그인 감지
      - BE: 로그인 아이디가 캐시에 존재하는 아이디를 비교하여 멀티로그인을 감지한다.
      - BE: 멀티로그인을 막기위해서 캐시에 아이디는 Unique하게 관리한다.
      - BE: 이전 로그인 사용자에게 Websocket을 통해 Message를 전송한다.
      - FE: "새로운 로그인이 확인 되었습니다. 자동으로 로그아웃됩니다!" 메시지를 포함한 모달 박스를 화면에 표시한다.
      - FE: 사용자를 로그인 페이지로 리다이렉트한다.
    - FE: 로그인 성공 후 메인 화면으로 이동한다.
  - 로그인 인증 실패:
    - BE: 검증 실패 시 "등록되지 않은 사용자입니다. 관리자에게 문의 하세요" 메시지를 Client로 전송한다.
      - FE: 시스템에서 전송된 메시지를 alert notification으로 표시한다.
    - BE: 비밀번호 오류횟수 + 1을 하여 DB에 저장한다.
    - BE: 비밀번호 오류횟수가 5를 초과하면 계정 상태를 잠금으로 변경하고 "계정이 잠겼습니다. 관리자에게 문의하세요!" 라는 메시지를 Client에 전송한다.
      - FE: 시스템에서 전송된 메시지를 alert notification으로 표시한다.
    - BE: 계정 잠금 상태에서 로그인 시도:
      - BE: IP + 로그인 시도 횟수 + 1을 하여 DB에 저장한다.
      - BE: IP + 로그인 시도 횟수가 10을 초과하면 IP Black list DB에 저장하고 캐시를 reload 한다.
      - BE: IP Black List는 캐시에서 관리한다.
        - Black List에 존재하는 IP 접근시 "차단된 IP 입니다. 접속 IP : {ip}" 메시지를 Client로 전송한다.
        - FE: IP 차단 페이지로 리다이렉트하며, 시스템에서 전송된 메시지를 화면에 표시한다.
    - 정책:
      - 비밀번호 오류 횟수: 기본 5회
      - 로그인 시도 횟수: 기본 10회
- 테마 변경
  - FE: 사용자는 테마(dark, light)를 변경할 수 있다.
  - FE: 변경된 테마는 브라우저 session strage에 저장한다.
- 언어변경
  - FE: 사용자는 언어(kr, en, zh)를 변경할 수 있다.
  - FE: 변경된 언어는 브라우저 session storage에 저장한다.
- 토큰만료:
  - FE: Access token 만료시 refresh token을 이용해서 access token을 재요청 한다.
  - BE: DB에 저장된 Refresh token과 client에서 전송된 refresh token을 비교한다.
    - 검증 성공시 :
      - BE: 새로운 access token을 발급한다.
      - FE: 새로운 access token을 session storage에 저장한다.
    - 검증 실패시 :
      - BE : 유효하지 않거나, 만료가 되었다면 "세션이 만료 되었습니다. 다시 로그인 해주세요!" 라는 메시지를 Client에 전송한다.
        - FE : 시스템에서 전송받은 메시지를 alert notification으로 표시한다.


